# install_poker_coach.ps1
# Script de instalación completo de Poker Coach Pro

Write-Host " POKER COACH PRO - INSTALACIÓN COMPLETA" -ForegroundColor Cyan
Write-Host "=" * 80
Write-Host "Este script instalará todas las dependencias y configurará el sistema" -ForegroundColor Yellow
Write-Host "=" * 80
Write-Host ""

# 1. Verificar Python
Write-Host "1️⃣ VERIFICANDO PYTHON..." -ForegroundColor Green
$pythonVersion = python --version 2>&1
if ($LASTEXITCODE -eq 0) {
    Write-Host "   ✅ Python encontrado: $pythonVersion" -ForegroundColor Green
} else {
    Write-Host "   ❌ Python no encontrado. Instala Python 3.8+ desde python.org" -ForegroundColor Red
    exit 1
}

# 2. Crear entorno virtual
Write-Host "`n2 CREANDO ENTORNO VIRTUAL..." -ForegroundColor Green
if (Test-Path "venv") {
    Write-Host "    Entorno virtual ya existe" -ForegroundColor Gray
} else {
    python -m venv venv --prompt="PokerCoach"
    Write-Host "    Entorno virtual creado" -ForegroundColor Green
}

# 3. Activar entorno
Write-Host "`n3 ACTIVANDO ENTORNO VIRTUAL..." -ForegroundColor Green
if ($IsWindows) {
    .\venv\Scripts\Activate.ps1
} else {
    source venv/bin/activate
}
Write-Host "    Entorno activado: $(python --version)" -ForegroundColor Gray

# 4. Instalar dependencias
Write-Host "`n4️⃣ INSTALANDO DEPENDENCIAS..." -ForegroundColor Green

$dependencies = @(
    # Core
    "numpy==1.24.4",
    "opencv-python==4.9.0.80",
    "pillow==10.3.0",
    "pyautogui==0.9.54",
    "pytesseract==0.3.10",
    
    # Captura
    "mss==9.0.1",
    
    # Machine Learning
    "scikit-learn==1.3.2",
    "scikit-image==0.22.0",
    "pandas==2.1.4",
    "matplotlib==3.8.2",
    "albumentations==1.3.1",
    
    # Data augmentation
    "imgaug==0.4.0",
    
    # Configuración
    "pyyaml==6.0.1",
    
    # Utilidades
    "colorama==0.4.6",
    "tqdm==4.66.2",
    "python-dotenv==1.0.0",
    
    # Opcional: TensorFlow para ML avanzado
    # "tensorflow==2.15.0",
    
    # Opcional: PyQt5 para overlay mejorado
    # "pyqt5==5.15.10"
)

Write-Host " Instalando $($dependencies.Count) paquetes..." -ForegroundColor Gray

$progress = 0
foreach ($dep in $dependencies) {
    $progress++
    $percent = [math]::Round(($progress / $dependencies.Count) * 100)
    Write-Host "   [$percent%] Instalando $dep..." -ForegroundColor DarkGray
    pip install $dep -q 2>&1 | Out-Null
}

Write-Host " Todas las dependencias instaladas" -ForegroundColor Green

# 5. Verificar Tesseract OCR
Write-Host "`n5 VERIFICANDO TESSERACT OCR..." -ForegroundColor Green
$tesseractPath = "C:\Program Files\Tesseract-OCR\tesseract.exe"
if (Test-Path $tesseractPath) {
    Write-Host "    Tesseract encontrado en: $tesseractPath" -ForegroundColor Green
} else {
    Write-Host "     Tesseract no encontrado" -ForegroundColor Yellow
    Write-Host "    Descarga e instala Tesseract OCR:" -ForegroundColor Gray
    Write-Host "   https://github.com/UB-Mannheim/tesseract/wiki" -ForegroundColor Gray
}

# 6. Crear estructura de directorios
Write-Host "`n6 CREANDO ESTRUCTURA DE DIRECTORIOS..." -ForegroundColor Green

$dirs = @(
    "src\ocr",
    "src\gto",
    "src\overlay",
    "src\core",
    "src\screen_capture",
    "data\card_templates\auto_captured",
    "data\card_templates\pokerstars_real",
    "data\card_templates\augmented_dataset",
    "data\models",
    "data\training_splits",
    "data\calibration_samples",
    "config",
    "logs\test_results",
    "logs\test_captures",
    "logs\decisions",
    "logs\sessions"
)

foreach ($dir in $dirs) {
    if (-not (Test-Path $dir)) {
        New-Item -ItemType Directory -Force -Path $dir | Out-Null
        Write-Host "    Creado: $dir" -ForegroundColor Gray
    }
}

# 7. Crear archivos de configuración por defecto
Write-Host "`n7 CREANDO ARCHIVOS DE CONFIGURACIÓN..." -ForegroundColor Green

# Configuración del sistema
@'
# system_config.yaml - Configuración por defecto
system:
  name: "Poker Coach Pro"
  version: "3.0"
  mode: "development"
